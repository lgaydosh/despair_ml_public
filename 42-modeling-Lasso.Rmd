---
title: "42-modeling-Lasso"
output: html_notebook
---
Run 41-modeling-RF first

```{r lasso logistic model function}  
lasso_suicide <- function(#training_frame,         
                          #validation_frameï¼Œ
                          train,
                          k = 5,               # ks of k fold
                          lambda_tune){     

  lambda_tune = seq(0.1,1,0.1)
  
  
  straps_splits <- stratified(as.data.frame(train), c("h5mn8"), 0.9, bothSets = T) 
  # 
   training_frame <- straps_splits[[1]]
   validation_frame <- straps_splits[[2]]
  
  
  
  
  params <- as.matrix(lambda_tune)
  
  model_tune_list <- rep(NA, nrow(params))
  
  for(i in 1:nrow(params)){
    lasso_i <- h2o.glm(
      x=setdiff(data_subset_list, c("h5mn8")),
      y="h5mn8", 
      training_frame = as.h2o(training_frame),
      lambda = params[i],
      family = "binomial",
      alpha = 1,
      nfolds = 5,
      fold_assignment = "Stratified",
      score_each_iteration = T,
      seed = 42
    )
    
    result <- h2o.performance(lasso_i, as.h2o(validation_frame))
    
    model_tune_list[i] <- result@metrics$AUC
  }
  
  best_index <- which(model_tune_list==max(model_tune_list))[1]
  
  lasso_i <- h2o.glm(
      x=setdiff(data_subset_list, c("h5mn8")),
      y="h5mn8", 
      training_frame = as.h2o(training_frame),
      lambda = params[i],
      family = "binomial",
      alpha = 1,
      nfolds = 5,
      fold_assignment = "Stratified",
      score_each_iteration = T,
      seed = 42
    )

  return(list(lasso_i, h2o.performance(lasso_i, as.h2o(validation_frame))))
}

```




```{r}
combined_models_lasso <- vector(mode = "list", length = n)
combined_performances_lasso <- vector(mode = "list", length = n)


for(i in 1:length(straps)){
  results <- as.data.frame(straps$splits[[i]])%>% 
    lasso_suicide()
  
  combined_models_lasso[i] <- results[1]
  combined_performances_lasso[i] <- results[2]

}

#results[1]
combined_models_lasso[1]
combined_performances_lasso[1]
```

