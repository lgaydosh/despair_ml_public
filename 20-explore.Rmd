---
title: "20-explore"
output: html_notebook
---

# Basic Exploration

Exploratory data analysis (an approach to analyzing data sets to summarize their main characteristics, often with visual methods) can be performed here.


```{r load libraries}
library(tidyverse)
library(DataExplorer)
```

```{r generic missing}
graph_missing <- function(df, 
                          title = "Percent Missing", 
                          box_line_size = .3, 
                          label_size = .15, 
                          x_axis_size = 12, 
                          y_axis_size = 12, 
                          title_size = 15){
  # df: data frame to plot missingness
  # title: graph title
  # box_line_size: size of box-line around percent missing
  # label_size: size of label
  # x_axis_size: font size for x-axis
  # y_axis_size: font size for y-axis
  # title_size = font size for title
  
  plot_missing(data = df,
               title = title,
               geom_label_args = list(label.size = box_line_size, 
                                      label.r = unit(0, "lines"),
                                      label.padding = unit(label_size, "lines")),
               theme_config = list(plot.title = element_text(hjust = 0.5, size = title_size),
                                   axis.text.x = element_text(size = x_axis_size),
                                   axis.text.y = element_text(size = y_axis_size)))
}

# Example
# create random amount of missing data (25% - 75%) in mtcars
# set.seed(42)
# mtcars %>% 
#   map_df(function(z) replace(x = z,
#                              list = sample(x = 1:length(z),
#                                            size = length(z)*runif(1,.25,.75)),
#                              values = NA)) %>% 
#   graph_missing()

```

```{r generic scatterplot}
graph_scatterplot <- function(df, 
                              outcome, 
                              plot_title = "Scatterplots of Variables",
                              opacity = 1,
                              point_color = "black",
                              point_size = 1,
                              num_rows = 3,
                              num_cols = 3,
                              x_axis_size = 12,
                              y_axis_size = 12,
                              title_size = 15){
  # df: data frame to plot
  # plot_title: graph title
  # opacity: How opaque the points should be, scale of 0 to 1
  # point_color: color of the points
  # point_size = size of point
  # num_rows: number of rows for output graphs
  # num_cols: number of columns for outcome graphs
  # x_axis_size: font size for x-axis
  # y_axis_size: font size for y-axis
  
  df %>% 
    plot_scatterplot(by = outcome, 
                     title = plot_title,
                     geom_point_args = list(size = point_size, 
                                            alpha = opacity, 
                                            color = point_color),
                     nrow = num_rows,
                     ncol = num_cols,
                     theme_config = list(plot.title = element_text(hjust = 0.5, size = title_size),
                               axis.text.x = element_text(size = x_axis_size),
                               axis.text.y = element_text(size = y_axis_size)))
}
# Example
# mtcars %>% 
#   graph_scatterplot(outcome = "gear", opacity = .5, point_size = 2, point_color = "red", num_rows = 4)
```


```{r generic frequency discrete}
graph_bar_discrete <- function(df,
                      plot_title = "Distributions of Discrete Variables",
                      max_categories = 50,
                      num_rows = 3,
                      num_cols = 3,
                      x_axis_size = 12,
                      y_axis_size = 12,
                      title_size = 15){
  # df: data frame to plot missingness
  # plot_title: Title of plot
  # num_bins: number of bins for the graph
  # num_rows: how many rows to have for output
  # num_cols: how many columns to have for output
  # x_axis_size: font size for x-axis
  # y_axis_size: font size for y-axis
  # title_size: font size for graph title
  
  plot_bar(data = df,
           maxcat = max_categories,
           nrow = num_rows,
           ncol = num_cols,
           title = plot_title,
           theme_config = list(plot.title = element_text(hjust = 0.5, size = title_size),
                               axis.text.x = element_text(size = x_axis_size),
                               axis.text.y = element_text(size = y_axis_size)))
  
}

# # Example 1
# graph_bar_discrete(mtcars, num_rows = 1, num_cols = 2)
# 
# # Example 2
# graph_bar_discrete(mtcars, num_rows = 2, num_cols = 1)
```

```{r generic boxplots}
graph_boxplot <- function(df, 
                          outcome, 
                          plot_title = "Boxplots", 
                          num_rows = 4, 
                          num_cols = 2, 
                          x_axis_size = 12,
                          y_axis_size = 12,
                          title_size = 15){
  # df: data frame
  # outcome: outcome variable
  # plot_title: title of graph. Note that "By <outcome>" is appended
  # num_rows: number of rows for output
  # num_cols: number of columsn for output
  # x_axis_size: size of text for x-axis
  # y_axis_size: size of text for y-axis
  # return: boxplots for covariates
  
  plot_title <- str_c(plot_title, "by", outcome, sep = " ")
  
  df %>% 
    plot_boxplot(by = outcome,
                 title = plot_title,
                 nrow = num_rows,
                 ncol = num_cols,
                 theme_config = list(plot.title = element_text(hjust = 0.5, size = title_size),
                               axis.text.x = element_text(size = x_axis_size),
                               axis.text.y = element_text(size = y_axis_size)))
}

# Example 1
# iris %>% graph_boxplot(outcome = "Species")

# Example 2
# mtcars %>% graph_boxplot(outcome = "gear")
```

```{r generic correlations}
graph_correlation <- function(df, 
                              var_type = "all", 
                              max_categories = 10, 
                              plot_title = "Heatmap of all variables",
                              x_axis_size = 12,
                              y_axis_size = 12,
                              title_size = 15){
  # df: data frame to create heatmap for
  # var_type: type of data to create heatmap for - c("all", "discrete", "continuous")
  # max_categories: maximum number of categories allowed for each discrete feature
  # plot_title: Title of graph
  # x_axis_size: size of x-axis
  # y_axis_size: size of y-axis
  # title_size: size of graph title
  # return: heatmap
  
  df %>% 
    plot_correlation(type = var_type,
                     maxcat = max_categories,
                     title = plot_title,
                     theme_config = list(plot.title = element_text(hjust = 0.5, size = title_size),
                               axis.text.x = element_text(size = x_axis_size),
                               axis.text.y = element_text(size = y_axis_size)))
}

# Example 1 - only continuous variables
# mtcars %>% graph_correlation(var_type = "continuous")

# Example 2 - only discrete variables
# iris %>% graph_correlation(var_type = "discrete")

# Example 3 - all variables
# iris %>% graph_correlation(var_type = "all", x_axis_size = 10)
```

