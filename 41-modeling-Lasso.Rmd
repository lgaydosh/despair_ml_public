---
title: "41-modeling-Lasso"
output: html_notebook
---

```{r lasso logistic model function}

# The steps are not in order because the function needed to be created first.
lasso_suicide <- function(train,           # training set or bootstrap
                       k = 5,               # ks of k fold
                       lambda_tune){     
  
  model_list <- vector(mode = "list", length = n) # creating an empty list to save all the models
  results_list <- vector(mode = "list", length = n) # creating an empty list to save all the model validation results
  
  
  #straps$splits[[i]]
  # Step 3
  straps_splits <- stratified(as.data.frame(train), c("h5mn8"), 0.9, bothSets = T) 
  
  training_frame <- straps_splits[[1]]
  validation_frame <- straps_splits[[2]]
  
  # Step 4
  params <- expand.grid(lambda_tune = seq(0,1))
  
  model_tune_list <- rep(NA, nrow(params))
  
  for(i in 1:nrow(params)){
    lasso_i <- h2o.glm(
      training_frame = as.h2o(training_frame),
      x=setdiff(data_subset_list, c("h5mn8")),
      y="h5mn8", 
      lambda_tune = params[i,][[1]],
      family = "binomial",
      alpha = 1,
      nfolds = 5,
      fold_assignment = "Stratified",
      score_each_iteration = T,
      seed = 42
    )
    
    result <- h2o.performance(lasso_i, as.h2o(validation_frame))
    
    model_tune_list[i] <- result@metrics$AUC
  }
  
  best_index <- which(model_tune_list==max(model_tune_list))[1]
  
  lasso_i <- h2o.glm(
      training_frame = as.h2o(training_frame),
      x=setdiff(data_subset_list, c("h5mn8")),
      y="h5mn8", 
      lambda_tune = params[i,][[1]],
      family = "binomial",
      alpha = 1,
      nfolds = 5,
      fold_assignment = "Stratified",
      score_each_iteration = T,
      seed = 42
    )
  
  # model_list[i] <- rf_i
  # results_list[i] <- h2o.performance(rf_i, as.h2o(validation_frame))
  
  return(list(lasso_i, h2o.performance(lasso_i, as.h2o(validation_frame))))
}

```


