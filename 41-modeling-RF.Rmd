---
title: "41-modeling-RF"
output: html_notebook
---

```{r}
library(data.table)
library(mlr)
library(splitstackshape)
library(boot)
```

# Creating the subset of the dataset we will be using for the model
Note:
1. Have not added age, race and sex/gender information in this subset as of yet. 
2. Initially creating the model to predict suicidal ideation at wave 5. 
3. Initially making the decision to remove all NA values in wave 5.

```{r}
library(tidyverse)
library(rsample)

data_subset_list <- setdiff(predictor_list, "aid") %>% append("h5mn8")

data_subsets <- joined_waves[data_subset_list] %>% na.omit() %>% bootstraps(times = 2) # Creating 2 samples


summary(data_subsets)


```

```{r stratified train-test split}
#set.seed(42) -- Consider updating seed at every iteration or model creation
#splits <- as.h2o(stratified(data_subset, c("h5mn8"), 0.7, bothSets = T))
splits <- stratified(data_subset, c("h5mn8"), 0.7, bothSets = T)

train <- as.h2o(splits[[1]])

test <- as.h2o(splits[[2]])



## what if bootstrap here

subsets_resample <- nested_cv(train, 
                     outside = vfold_cv(repeats = 5), 
                     inside = bootstraps(2))


```

```{r}
rf1 <- h2o.randomForest(
  training_frame = train,
  x=setdiff(predictor_list, c("aid","h5mn8")),
  y=49, 
  model_id = "rf_covType_v1",
  ntrees = 500, 
  max_depth = 10,
  stopping_rounds = 2,
  nfolds = 5,
  fold_assignment = "Stratified",
  score_each_iteration = T,
  seed = 1000000)

rf1
```


```{r}

RF <- function(ntrees = 500,max_depth = 10 ){
  rf1 <- h2o.randomForest(
    training_frame = train,
    x=setdiff(predictor_list, c("aid","h5mn8")),
    y="h5mn8", 
    model_id = "rf_covType_v1",
    ntrees, 
    max_depth,
    stopping_rounds = 2,
    nfolds = 5,
    fold_assignment = "Stratified",
    score_each_iteration = T,
    seed = 1000000)


  return(rf1)
}



```



```{r}
summary(rf1)
```




