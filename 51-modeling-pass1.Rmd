---
title: "51-modeling-pass1"
output: html_document
---

The purpose of this document is to create the models used for the exploration in the file 60 series.

```{r load libraries}
# these are the libraries needed to run the code below
library(data.table)
library(mlr)
library(splitstackshape) #stratified function
library(boot)
library(tidyverse)
library(rsample)
```


```{r convenience functions}
# This function performs a stratified split
strat_split <- function(df, strat_var, split_prop, train_out = T){
  # df: input dataframe
  # strat_var: variable to stratify on
  # train_prop: proption to split for train/testing
  # train_out: set to TRUE for training frame, set to FALSE for validation frame
  # returns: training or testing tibble
  
  # create stratified split
  splits <- stratified(df, strat_var, split_prop, bothSets = T)
  train <- splits[[1]]
  test <- splits[[2]]
  
  # return tibble of training set if train_out == True
  if(train_out == T){out <- train}
  else{out<-test}
  return(out)
}

# Get total value based on placement of variable importance
get_total_placement <- function(df){
  # df: a data frame returned from the get_top_n_names function
  # returns: a data frame grouped by all variables with sum total of placement
  
  out <- df %>%
    bind_rows() %>% 
    group_by(variable) %>% 
    summarise(total = sum(placement))
  
  # return tibble
  return(out)
}

```


```{r create splits for training and testing on suicide_df}
# Get training frame
training_df <- suicide_df %>% 
  strat_split(strat_var = c("h5mn8"),split_prop = 0.7, train_out = TRUE)

# Get testing frame
testing_df <- suicide_df %>% 
  strat_split(c("h5mn8"),0.7, FALSE)
```


```{r test suicide model}
# suicide_w5 was created earlier - it is the suicide indicator at wave 5
suicide_out <- training_df %>% 
  rf_feature_selection(outcome = suicide_w5)
```


